services:
  crowdsec:
    ports:
      # crowdsec-bouncer-tipi
      - "8081:8080" # TODO: ${APP_PORT}:8080 #8081
    volumes: !override
      - /etc/localtime:/etc/localtime:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /var/log:/var/log:ro
      - ${APP_DATA_DIR}/data/crowdsec/db:/var/lib/crowdsec/data
      - ${APP_DATA_DIR}/data/crowdsec:/etc/crowdsec
    environment:
      - COLLECTIONS= crowdsecurity/apache2 firix/authentik crowdsecurity/http-cve gauth-fr/immich crowdsecurity/iptables xs539/joplin-server crowdsecurity/linux crowdsecurity/sshd crowdsecurity/traefik crowdsecurity/whitelist-good-actors
  crowdsec-dashboard:
    labels:
      # Websecure
      traefik.http.routers.crowdsec-dashboard.middlewares: chain-Domain-auth@file
      traefik.http.routers.crowdsec-dashboard.tls.certresolver: ''
      # WebSecure local IP
      traefik.http.routers.crowdsec-dashboard-privip.rule: Host(`${APP_DOMAIN}`) && ClientIP(`${PRIVATE_IPV4}`)
      traefik.http.routers.crowdsec-dashboard-privip.middlewares: chain-Domain@file
      traefik.http.routers.crowdsec-dashboard-privip.entrypoints: websecure
      traefik.http.routers.crowdsec-dashboard-privip.service: crowdsec-dashboard
      traefik.http.routers.crowdsec-dashboard-privip.priority: 100
      traefik.http.routers.crowdsec-dashboard-privip.tls.certresolver: ''
